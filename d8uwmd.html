<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¡µé¢è®¿é—®ç»Ÿè®¡</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .stats-container { max-width: 1000px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: #333; margin-bottom: 10px; }
        .update-info { color: #666; font-size: 14px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 12px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .stat-card h3 { margin: 0 0 10px 0; font-size: 18px; opacity: 0.9; }
        .stat-card .number { font-size: 32px; font-weight: bold; margin: 0; }
        .time-filter { text-align: center; margin: 30px 0; }
        .time-btn { padding: 12px 24px; margin: 0 8px; border: 2px solid #ddd; background: white; cursor: pointer; border-radius: 8px; font-size: 14px; transition: all 0.3s; }
        .time-btn:hover { border-color: #667eea; color: #667eea; }
        .time-btn.active { background: #667eea; color: white; border-color: #667eea; }
        .page-records { margin-top: 30px; }
        .page-record { background: white; border: 1px solid #e0e0e0; padding: 20px; margin: 15px 0; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .page-record h4 { margin: 0 0 10px 0; color: #333; font-size: 18px; }
        .page-record .url { color: #666; margin: 5px 0; word-break: break-all; }
        .page-record .count { color: #667eea; font-weight: bold; font-size: 16px; }
        .loading { text-align: center; padding: 40px; color: #666; }
        .error { background: #ffebee; color: #c62828; padding: 15px; border-radius: 8px; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="stats-container">
        <div class="header">
            <h1>ğŸ“Š é¡µé¢è®¿é—®ç»Ÿè®¡</h1>
            <div class="update-info">
                ğŸ”„ æ­¤é¡µé¢é€šè¿‡GitHub APIå®æ—¶æ›´æ–°ï¼Œæ•°æ®æ¥æºï¼šjiluä»“åº“
            </div>
        </div>
        
        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3>æ€»è®¿é—®æ¬¡æ•°</h3>
                <div class="number" id="totalViews">-</div>
            </div>
            <div class="stat-card">
                <h3>ä»Šæ—¥è®¿é—®æ¬¡æ•°</h3>
                <div class="number" id="todayViews">-</div>
            </div>
            <div class="stat-card">
                <h3>å”¯ä¸€é¡µé¢</h3>
                <div class="number" id="uniquePages">-</div>
            </div>
        </div>
        
        <!-- æ—¶é—´ç­›é€‰ -->
        <div class="time-filter">
            <button class="time-btn active" data-time="all">æ‰€æœ‰æ—¶é—´</button>
            <button class="time-btn" data-time="24h">24å°æ—¶</button>
            <button class="time-btn" data-time="7d">æœ€è¿‘ä¸€å‘¨</button>
            <button class="time-btn" data-time="30d">æœ€è¿‘ä¸€æœˆ</button>
        </div>
        
        <!-- è®¿é—®è®°å½• -->
        <div id="pageRecords" class="page-records">
            <div class="loading">æ­£åœ¨åŠ è½½ç»Ÿè®¡æ•°æ®...</div>
        </div>
    </div>

    <script>
        // ===== é…ç½®ä¿¡æ¯ =====
        const GITHUB_OWNER = 'pa-kos';
        const GITHUB_REPO = 'jilu';
        const GITHUB_BRANCH = 'main';
        
        // ===== è·å–åŒ—äº¬æ—¶é—´çš„å‡½æ•° =====
        function getBeijingTime() {
            const now = new Date();
            const beijingOffset = 8 * 60; // åŒ—äº¬æ—¶é—´ UTC+8
            const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
            return new Date(utc + (beijingOffset * 60000));
        }
        
        // ===== æ ¼å¼åŒ–æ—¶é—´ =====
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const beijingDate = new Date(date.getTime() + (8 * 60 * 60 * 1000));
            return beijingDate.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }
        
        // ===== å¤„ç†ç»Ÿè®¡æ•°æ® =====
        function processStatsData(data, timeFilter) {
            const now = getBeijingTime();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            
            let filteredData = data;
            
            // æ ¹æ®æ—¶é—´ç­›é€‰æ•°æ®
            switch(timeFilter) {
                case '24h':
                    const yesterday = new Date(today.getTime() - 24 * 60 * 60 * 1000);
                    filteredData = data.filter(item => new Date(item.recorded_at) >= yesterday);
                    break;
                case '7d':
                    const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                    filteredData = data.filter(item => new Date(item.recorded_at) >= weekAgo);
                    break;
                case '30d':
                    const monthAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
                    filteredData = data.filter(item => new Date(item.recorded_at) >= monthAgo);
                    break;
            }
            
            // è®¡ç®—ç»Ÿè®¡æ•°æ®
            const totalViews = filteredData.length;
            const todayViews = filteredData.filter(item => {
                const itemDate = new Date(item.recorded_at);
                const itemBeijingDate = new Date(itemDate.getTime() + (8 * 60 * 60 * 1000));
                return itemBeijingDate >= today;
            }).length;
            
            // æŒ‰é¡µé¢åˆ†ç»„ç»Ÿè®¡
            const pageGroups = {};
            filteredData.forEach(item => {
                const key = `${item.url}|${item.title}`;
                if (!pageGroups[key]) {
                    pageGroups[key] = {
                        url: item.url,
                        title: item.title,
                        count: 0
                    };
                }
                pageGroups[key].count++;
            });
            
            const uniquePages = Object.keys(pageGroups).length;
            
            // æŒ‰è®¿é—®æ¬¡æ•°æ’åº
            const sortedPages = Object.values(pageGroups).sort((a, b) => b.count - a.count);
            
            return {
                totalViews,
                todayViews,
                uniquePages,
                pages: sortedPages
            };
        }
        
        // ===== ç”Ÿæˆç»Ÿè®¡é¡µé¢ =====
        function generateStatsPage(data) {
            const stats = processStatsData(data, 'all');
            
            // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
            document.getElementById('totalViews').textContent = stats.totalViews;
            document.getElementById('todayViews').textContent = stats.todayViews;
            document.getElementById('uniquePages').textContent = stats.uniquePages;
            
            // ç”Ÿæˆé¡µé¢è®°å½•
            const recordsContainer = document.getElementById('pageRecords');
            recordsContainer.innerHTML = '';
            
            if (stats.pages.length === 0) {
                recordsContainer.innerHTML = '<div class="error">æš‚æ— è®¿é—®è®°å½•</div>';
                return;
            }
            
            stats.pages.forEach(page => {
                const recordDiv = document.createElement('div');
                recordDiv.className = 'page-record';
                recordDiv.innerHTML = `
                    <h4>${page.title}</h4>
                    <div class="url">${page.url}</div>
                    <div class="count">ç´¯è®¡è®¿é—®æ¬¡æ•°: ${page.count}</div>
                `;
                recordsContainer.appendChild(recordDiv);
            });
        }
        
        // ===== åŠ è½½ç»Ÿè®¡æ•°æ® =====
        async function loadStats() {
            try {
                const response = await fetch(`https://raw.githubusercontent.com/${GITHUB_OWNER}/${GITHUB_REPO}/${GITHUB_BRANCH}/stats-data/access-logs.json`);
                if (response.ok) {
                    const data = await response.json();
                    generateStatsPage(data);
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
                document.getElementById('pageRecords').innerHTML = `
                    <div class="error">
                        è·å–ç»Ÿè®¡æ•°æ®å¤±è´¥: ${error.message}<br>
                        è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•
                    </div>
                `;
            }
        }
        
        // ===== æ—¶é—´ç­›é€‰åŠŸèƒ½ =====
        document.addEventListener('DOMContentLoaded', function() {
            // åŠ è½½åˆå§‹æ•°æ®
            loadStats();
            
            // ç»‘å®šæ—¶é—´ç­›é€‰æŒ‰é’®
            const timeButtons = document.querySelectorAll('.time-btn');
            timeButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰activeç±»
                    timeButtons.forEach(b => b.classList.remove('active'));
                    // æ·»åŠ activeç±»åˆ°å½“å‰æŒ‰é’®
                    this.classList.add('active');
                    
                    // é‡æ–°åŠ è½½æ•°æ®
                    loadStats();
                });
            });
            
            // æ¯5åˆ†é’Ÿè‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡
            setInterval(loadStats, 5 * 60 * 1000);
        });
    </script>
</body>
</html>
